## 微信支付

1. 小程序中下单，将订单数据传递给商户的后端服务器。商户的后端服务器生成一个订单，默认订单的状态为未支付。

2. 商户后端服务器给微信支付服务器发送请求，(将订单编号、订单价格、订单商品、商户号（必须传递）、签名信息,就是生成的订单)发送到微信服务器，微信服务器会生成一个预订单。将预订单的标志符返回给商户后端服务器。

   （如果微信服务器里没有这个订单，微信平台无法验证支付）

3. 生成了预订单后，前端代码调用wx.requestPaymenet({ 参数比较多})发起支付（这些参数我们需要按照文档来准备，签名信息、加密的方式……）

4. 请求发送到后端后，后端唤起微信支付程序，来执行支付流程。

5. 微信应用程序就会和微信服务器之间进行身份认证（是否有权限、身份是正确、订单是否存在、是否超时，返回支付授权到微信应用）

6. 微信就会唤起本地的支付窗口。用户就可以在窗口里输入密码

7. 微信接受密码，将密码发送(提交授权)给微信服务器进行验证。

8. 服务服务器调用商户的服务器某一个路径（异步回调）。商户服务器就可以接受支付结果，后端就可以修改订单的状态

9. 微信主动发送请求获取支付结果，服务返回支付结果，显示到页面中，展示支付信息



pc区别在于，一旦我们要支付的时候，微信服务器会返回一个支付页面，或者支付二维码。你需要显示到页面上。用户手机扫一扫，也是直接用微信和微信服务器通信





注册商户号：

1、微信支付商户平台（公司准备资料），页面进入，扫码登陆，新增商户号或微信号

2、选择身份是超级管理员(负责人做)，还是员工，如负责人：

- (1).超管扫码，含本人银行卡，商户号和一致的联系实名人，（商户号：）
- (2).完整的商户信息。
- (3).手机短信验证码

3？、微信开放平台：功能-微信支付（进入右边商户号管理，接入微信支付）（1）发起申请，1234.。(2)完成上面4步，显示待关联商户号。









